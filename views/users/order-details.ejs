<%- include('../layouts/userHeader.ejs') %>
  <!-- Header -->
  <header class="header-v4">
    <!-- Header desktop -->
    <div class="container-menu-desktop">
      <!-- Topbar -->
      <div class="top-bar">
        <div class="content-topbar flex-sb-m h-full container">
          <div class="left-top-bar">
            Free shipping for standard order over â‚¹ 1000
          </div>
          <div class="right-top-bar flex-w h-full">
            <a href="/profile" class="flex-c-m trans-04 p-lr-25">
              My Account
            </a>
          </div>
        </div>
      </div>

      <div class="wrap-menu-desktop">
        <nav class="limiter-menu-desktop container">
          <!-- Logo desktop -->
          <a href="/" class="logo">
            <img src="assets/images/icons/logo-01.png" alt="IMG-LOGO">
          </a>

          <!-- Menu desktop -->
          <div class="menu-desktop">
            <ul class="main-menu">
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/shop">Shop</a>
              </li>
              <li>
                <a href="/cart">Cart</a>
              </li>
              <li>
                <a href="/contact">Contact</a>
              </li>
              <li>
                <a href="/profile">My Account</a>
                <ul class="sub-menu">
                  <li><a href="/profile">Profile</a></li>
                  <li><a href="/orders">Orders</a></li>
                  <li><a href="/logout">Logout</a></li>
                </ul>
              </li>
            </ul>
          </div>

          <!-- Icon header -->
          <div class="wrap-icon-header flex-w flex-r-m">
            <% if(!userCart ){ %>
              <a href="/cart" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
                data-notify="0">
                <i class="zmdi zmdi-shopping-cart"></i>
              </a>
              <% } else { %>
                <a href="/cart" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
                  data-notify="<%= userCart.products.length %>">
                  <i class="zmdi zmdi-shopping-cart"></i>
                </a>
                <% } %>

                  <% if(!wishlist ){ %>
                    <a href="/wishlist"
                      class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
                      data-notify="0">
                      <i class="zmdi zmdi-favorite-outline"></i>
                    </a>
                    <% } else { %>
                      <a href="/wishlist"
                        class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
                        data-notify="<%= wishlist.products.length %>">
                        <i class="zmdi zmdi-favorite-outline"></i>
                      </a>
                      <% } %>
          </div>
        </nav>
      </div>
    </div>

    <!-- Header Mobile -->
    <div class="wrap-header-mobile">
      <!-- Logo moblie -->
      <div class="logo-mobile">
        <a href="/"><img src="assets/images/icons/logo-01.png" alt="IMG-LOGO"></a>
      </div>

      <!-- Icon header -->
      <div class="wrap-icon-header flex-w flex-r-m m-r-15">
        <% if(!userCart ){ %>
          <a href="/cart">
            <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti " data-notify="0">
              <i class="zmdi zmdi-shopping-cart"></i>
            </div>
          </a>
          <% } else { %>
            <a href="/cart">
              <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti "
                data-notify="<%= userCart.products.length %>">
                <i class="zmdi zmdi-shopping-cart"></i>
              </div>
            </a>
            <% } %>

              <% if(!wishlist ){ %>
                <a href="/wishlist"
                  class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti"
                  data-notify="0">
                  <i class="zmdi zmdi-favorite-outline"></i>
                </a>
                <% } else { %>
                  <a href="/wishlist"
                    class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti"
                    data-notify="<%= wishlist.products.length %>">
                    <i class="zmdi zmdi-favorite-outline"></i>
                  </a>
                  <% } %>
      </div>

      <!-- Button show menu -->
      <div class="btn-show-menu-mobile hamburger hamburger--squeeze">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </div>
    </div>

    <!-- Menu Mobile -->
    <div class="menu-mobile">
      <ul class="topbar-mobile">
        <li>
          <div class="left-top-bar">
            Free shipping for standard order over Rs 1000
          </div>
        </li>
      </ul>
      <ul class="main-menu-m">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/shop">Shop</a>
        </li>
        <li>
          <a href="/cart">Cart</a>
        </li>
        <li>
          <a href="/contact">Contact</a>
        </li>
        <li>
          <a href="/profile">My Account</a>
          <ul class="sub-menu-m">
            <li><a href="/profile">Profile</a></li>
            <li><a href="/orders">Orders</a></li>
            <li><a href="/logout">Logout</a></li>
          </ul>
          <span class="arrow-main-menu-m">
            <i class="fa fa-angle-right" aria-hidden="true"></i>
          </span>
        </li>
      </ul>
    </div>    
  </header>

  <!-- Breadcrumb Section Begin -->
  <section class="breadcrumb-option">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="breadcrumb__text">
            <h4>Your Orders</h4>
            <div class="breadcrumb__links">
              <a href="/">Home</a>
              <a href="/profile">Profile</a>
              <a href="/orders">Orders</a>
              <span>
                <%= order._id %>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Breadcrumb Section End -->

  <section style="background-color: #ffffff;">
    <div class="container py-3 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-12">
          <div class="card card-stepper text-black" style="border-radius: 16px; background-color: #f3f2ee;">
            <div class="card-body ">
              <div class="d-flex justify-content-between align-items-center ">
                <div class="row">
                  <h5 class="mb-0 cl10" >INVOICE No :<span class="text-dark font-weight-bold">
                      <%= order._id %>
                    </span></h5>
                </div>
                <div class="text-end col mb-3">
                  <% let arrivalDate=new Date(order.orderDate); %>
                    <% arrivalDate.setDate(arrivalDate.getDate() + 7); %>
                      <b>
                        <p class="mb-0 cl10">Expected Arrival : <span class="font-weight-bold">
                            <%= arrivalDate.toISOString().slice(0, 10) %>
                          </span></p>
                      </b>
                </div>
              </div>
              <div>
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col mb-3">
                      <h5 class=" cl10 mb-1">Date :  <%= order.orderDate %> </h5>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col mb-3">
                      <h5 class=" cl10 mb-1">Delivery Address </h5>
                      <span> 
                        <%= address.name %>,
                        <%= address.pincode %>,
                            <%= address.landmark %>,
                                <%= address.address %>,
                                    <%= address.mobile %>
                      </span>
                    </div>
                  </div>
                  <div class="mx-n5  py-4" style="background-color: #f2f2f2;">
                    <div class="row ">
                      <% order.products .forEach(element=> { %>
                        <div class="col-md-8 col-lg-9 mb-4" style="display: flex; align-items: center;">
                          <img src="/images/<%= element.productID.image[0] %>" alt="" width="100px">
                          <p class="p-l-50">
                            <%= element.name %> x <%= element.quantity %>
                          </p>
                        </div>
                        <div class="col-md-4 col-lg-3 d-flex align-items-center">
                          <p>Rs <%= element.price %>
                          </p>
                        </div>
                        <br><br>
                        <% }); %>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-4 offset-md-8 col-lg-3 offset-lg-9">
                      <p class="lead fw-bold mb-0" style="color: #000000;">Total <%= order.Total %>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <% if (order.orderStatus=='Placed' ) {%>
                <ul id="progressbar-2" class="d-flex justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2">
                  <li class="  active text-center" id="step1"></li>
                  <li class="    text-center" id="step2"></li>
                  <li class="     text-center" id="step3"></li>
                  <li class="  text-center " id="step4"></li>
                </ul>
                <% }else if (order.orderStatus=='Shipped' ) {%>
                  <ul id="progressbar-2" class="d-flex justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2">
                    <li class="  active lineActive text-center" id="step1"></li>
                    <li class="   active text-center" id="step2"></li>
                    <li class="     text-center" id="step3"></li>
                    <li class="  text-center " id="step4"></li>
                  </ul>
                  <% } else if (order.orderStatus=='Out for Delivery' ) {%>
                    <ul id="progressbar-2" class="d-flex justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2">
                      <li class="  active lineActive text-center" id="step1"></li>
                      <li class="   active lineActive text-center" id="step2"></li>
                      <li class="   active  text-center" id="step3"></li>
                      <li class="  text-center " id="step4"></li>
                    </ul>
                    <% } else if (order.orderStatus=='Delivered' ){%>
                      <ul id="progressbar-2" class="d-flex justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2">
                        <li class="  active lineActive text-center" id="step1"></li>
                        <li class="   active lineActive text-center" id="step2"></li>
                        <li class="   active  lineActive text-center" id="step3"></li>
                        <li class=" active text-center " id="step4"></li>
                      </ul>
                      <% } else if (order.orderStatus=='Cancelled' || order.orderStatus=='Returned' ){%>
                        <ul id="progressbar-2" class="d-flex justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2">
                          <li class="  active  text-center" id="step5"></li>
                          <li class="     text-center" id="step5"></li>
                          <li class="      text-center" id="step5"></li>
                          <li class=" active text-center " id="step5"></li>
                        </ul>
                        <% } %>

                          <div class="d-flex justify-content-between">
                            <div class="d-lg-flex align-items-center">
                              <i class="fas fa-clipboard-list fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                              <div>
                                <p class="fw-bold mb-1">Order</p>
                                <p class="fw-bold mb-0">Placed</p>
                              </div>
                            </div>
                            <div class="d-lg-flex align-items-center">
                              <i class="fas fa-shipping-fast fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                              <div>
                                <p class="fw-bold mb-1">Order</p>
                                <p class="fw-bold mb-0">Shipped</p>
                              </div>
                            </div>
                            <div class="d-lg-flex align-items-center">
                              <i class="fas fa-box-open  fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                              <div>
                                <p class="fw-bold mb-1">Out for</p>
                                <p class="fw-bold mb-0">Delivery</p>
                              </div>
                            </div>
                            <div class="d-lg-flex align-items-center">
                              <i class="fas fa-home fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                              <div>
                                <p class="fw-bold mb-1">Order</p>
                                <p class="fw-bold mb-0">Arrived</p>
                              </div>
                            </div>
                          </div>
                          <br><br>
                          <% if(order.returnStatus==true) {%>
                            <h3 style="color: #000000;">Your Order has been Returned</h3>
                            <%}else if(order.orderStatus=="Return Processing" ) {%>
                              <h3 style="color: crimson;">Order return Initiated ! Waiting for Seller Approval</h3>
                              <% }else if(order.orderStatus=="Delivered" ){ %>
                                <button class="btn btn-danger" onclick="returnOrder()"> Return Order</button>
                                <% } else if (order.orderStatus !="Cancelled" && order.orderStatus !="Returned" ){%>
                                  <button class="btn btn-danger" onclick="cancel()"> Cancel Order</button>
                                  <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    function cancel() {
      Swal.fire({
        title: 'Cancel this Order ?',
        text: '',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, confirm!'
      }).then((result) => {
        if (result.value) {
          window.location.href = '/cancel-order?id=<%= order._id %>';
        }
      })
    }

    function returnOrder() {
      Swal.fire({
        title: 'Return this order ?',
        text: '',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, confirm!'
      }).then((result) => {
        if (result.value) {
          window.location.href = '/return-order?id=<%= order._id %>';
        }
      })
    }
  </script>

  <%- include('../layouts/userFooter.ejs') %>